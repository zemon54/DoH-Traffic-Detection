DoH Detection Project

This project aims to detect DNS over HTTPS (DoH) traffic in network captures. It consists of three main Python scripts:

packet-statistics.py: This script captures network traffic using Pyshark and calculates various statistical features for each flow (communication between two endpoints). These features can potentially help identify DoH traffic patterns.
train_model.py: This script trains a machine learning model (KNeighborsClassifier by default) to classify network flows as DoH or benign traffic. It utilizes labeled datasets for training and evaluation.
prediction.py: This script loads a pre-trained model (KNeighborsClassifier) and uses it to predict labels (DoH or benign) for new, unseen network traffic captured using packet-statistics.py.
Running the Project:

Prerequisites:

Python 3.x (https://www.python.org/downloads/)
Necessary libraries:
Install them using pip install <library_name> for each library:
pyshark
pandas
scikit-learn
seaborn
matplotlib
joblib
Steps:

Data Collection:

Use a network capture tool (e.g., Wireshark) to capture network traffic that may contain both DoH and benign traffic.
Save the capture in a PCAP (pcapng) format.

Train the Model (Optional):

If you don't have a pre-trained model, you can train one using train_model.py. This script requires labeled datasets (CSV files) containing network flow features and corresponding labels (DoH or benign).
For training you can use the kaggle dataset https://www.kaggle.com/code/hamzamanssor/detection-doh-traffic-using-ml-models

Generate Features from Network Capture:

Place your PCAP file in the same directory as packet-statistics.py.
Run packet-statistics.py. This script will extract various features for each flow in the capture and save them to a CSV file named output_1.csv.

Make Predictions:

Place the generated output.csv file in the same directory as prediction.py.
Ensure a pre-trained model file (knn_model.pkl by default) is present in the same directory. This file should be generated by train_model.py if you trained your own model.
Run prediction.py. This script will use the pre-trained model to predict labels (DoH or benign) for each flow in output_1.csv. The predictions will be saved in a new CSV file named predictions.csv.

Output:

output.csv: This file contains various statistical features calculated for each flow in the network capture.
predictions.csv (generated by prediction.py): This file contains the predicted labels (DoH or benign) for each flow in output_1.csv.
Notes:

You can modify the configuration details (e.g., file paths, model selection) within the scripts as needed.
Consider exploring different machine learning models and hyperparameter tuning for potentially better DoH detection accuracy.
This is a basic framework for DoH detection. Further refinement and feature engineering may be necessary for real-world scenarios.
